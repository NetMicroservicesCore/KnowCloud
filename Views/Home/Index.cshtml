@model IEnumerable<KnowCloud.Models.Dto.ProductDto>
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@section Styles {
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css" rel="stylesheet" />
    <style>
        .product-card {
            border: 1px solid #eee;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

            .product-card:hover {
                transform: scale(1.03);
            }

        .product-image {
            height: 200px;
            object-fit: cover;
        }

        .price {
            font-weight: bold;
            color: #28a745;
        }

        .rating i {
            color: gold;
        }
    </style>
}

<div class="container mt-4 vw-100">
    <!-- Header principal -->
    <header class="store-header w-100">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-3 mb-3 mb-lg-0">
                    <h1><i class="fas fa-store me-2"></i>KnowCloud</h1>
                    <p class="mb-0">Los mejores productos al mejor precio</p>
                </div>
                <div class="col-lg-6 mb-3 mb-lg-0">
                    <div class="search-bar">
                        <input type="text" class="form-control" id="searchInput" placeholder="¿Qué estás buscando hoy?">
                        <button type="button" id="searchButton"><i class="fas fa-search"></i></button>
                    </div>
                </div>
                
            </div>
        </div>
    </header>
    <!-- Filtros -->
    <div class="row mb-4">
        <div class="col-md-3">
            <label class="roboto-thin-ExtraLight-200 title-morado">Buscar producto</label>
            <input type="text" class="form-control" id="searchInput" placeholder="Nombre del producto...">
        </div>
        <div class="col-md-3">
            <label class="roboto-thin-ExtraLight-200 title-morado">Precio máximo</label>
            <input type="number" class="form-control" id="priceFilter" placeholder="Precio máximo">
        </div>
        <div class="col-md-3">
            <label class="roboto-thin-ExtraLight-200 title-morado">Valoración mínima</label>
            <select class="form-control" id="ratingFilter">
                <option value="">Todas</option>
                <option value="1">1+ estrella</option>
                <option value="2">2+ estrellas</option>
                <option value="3">3+ estrellas</option>
                <option value="4">4+ estrellas</option>
            </select>
        </div>
        <div class="col-md-3">
            <label class="roboto-thin-ExtraLight-200 title-morado">Ordenar por</label>
            <select class="form-control" id="sortFilter">
                <option value="none">Seleccionar</option>
                <option value="priceAsc">Precio: menor a mayor</option>
                <option value="priceDesc">Precio: mayor a menor</option>
            </select>
        </div>
    </div>

    <!-- Carrusel de productos destacados -->
    <h4 class="mb-3 roboto-Medium-500 title-orange">Productos más buscados</h4>
    <div class="owl-carousel owl-theme mb-5">
        <div class="item">
            <div class="card" style="width: 18rem;">
                <img src="https://m.media-amazon.com/images/I/71ZsWZIkQ+L._AC_SY695_.jpg" class="img-fluid card-img-top" alt="Producto 1" />
                <div class="card-body">
                    <h5 class="card-title title-orange">Card title</h5>
                    <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
                    <a href="#" class="btn btn-primary">Ver más</a>
                </div>
            </div>
            </div>
        <div class="item">
            <div class="card" style="width: 18rem;">
                <img src="https://m.media-amazon.com/images/I/61vFB6cgvbL._AC_SY606_.jpg" class="img-fluid" alt="Producto 2" />
                <div class="card-body">
                    <h5 class="card-title title-orange">Card title</h5>
                    <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
                    <a href="#" class="btn btn-primary">Go somewhere</a>
                </div>
            </div>
            
            </div>
        <div class="item">
            <div class="card" style="width: 18rem;">
                <img src="https://m.media-amazon.com/images/I/61L4LlIfJ5L._AC_SX569_.jpg" class="img-fluid card-img-top" alt="Producto 3" />
                <div class="card-body">
                    <h5 class="card-title title-orange">Card title</h5>
                    <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
                    <a href="#" class="btn btn-primary">Go somewhere</a>
                </div>
            </div>
            
            </div>
        <div class="item">
            <div class="card" style="width: 18rem;">
                <img src="https://m.media-amazon.com/images/I/51HRSbhjLvL._AC_SY741_.jpg" class="img-fluid card-img-top" alt="Producto 4" />
                <div class="card-body">
                    <h5 class="card-title title-orange">Card title</h5>
                    <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
                    <a href="#" class="btn btn-primary">Go somewhere</a>
                </div>
            </div>
            
            </div>
    </div>

    <!-- Grid de productos -->
    <div class="row" id="productList">
        @foreach(var product in Model)
        {           
            <div class="col-md-4 mb-4 product-item" data-name="@product.Name" data-price="product.Price">
                <div class="product-card">
                    <img src="@product.ImageUrl" class="w-100 product-image" alt="@product.Name" />
                    <div class="p-3">
                        <h5 class="roboto-SemiBold-600 title-morado">@product.Name</h5>
                        <p class="price roboto-Medium-500">@string.Format("{0:c}", product.Price)</p>
                        <button class="btn btn-outline-primary btn-sm mt-2 roboto-Light-300">Ver detalles</button>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js"></script>
    <script>
        $(document).ready(function () {
            // Inicializa carrusel
            $('.owl-carousel').owlCarousel({
                loop: true,
                margin: 10,
                nav: true,
                responsive: {
                    0: { items: 1 },
                    600: { items: 2 },
                    1000: { items: 3 }
                }
            });

            // Función de filtrado
            function filterProducts() {
                const search = $('#searchInput').val().toLowerCase();
                const maxPrice = parseFloat($('#priceFilter').val());
                const minRating = parseInt($('#ratingFilter').val()) || 0;
                const sort = $('#sortFilter').val();

                let items = $('.product-item');

                // Filtro de búsqueda, precio y rating
                items.each(function () {
                    const name = $(this).data('name').toLowerCase();
                    const price = parseFloat($(this).data('price'));
                    const rating = parseInt($(this).data('rating'));

                    let match = true;

                    if (search && !name.includes(search)) match = false;
                    if (!isNaN(maxPrice) && price > maxPrice) match = false;
                    if (rating < minRating) match = false;

                    $(this).toggle(match);
                });

                // Ordenamiento
                if (sort !== 'none') {
                    const sortedItems = items.sort(function (a, b) {
                        let aPrice = parseFloat($(a).data('price'));
                        let bPrice = parseFloat($(b).data('price'));
                        return sort === 'priceAsc' ? aPrice - bPrice : bPrice - aPrice;
                    });

                    $('#productList').html(sortedItems);
                }
            }

            // Eventos
            $('#searchInput, #priceFilter, #ratingFilter, #sortFilter').on('input change', filterProducts);
        });
    </script>
}
